# 4. 전송 계층

## 역할

- 오류를 점검하여 오류 발생시 데이터 재전송 요청
- 전송된 데이터의 목적지가 어떤 어플리케이션인지 식별



## 연결형 통신과 비연결형 통신

- 신뢰성, 정확성 vs. 효율성
- TCP: Transmission Control Protocol ; <연결형 통신> 신뢰할 수 있고 정확한 데이터 전송이 필요한 어플리케이션에 사용하는 통신
- UDP: User Datagram Protocol ; <비연결형 통신> 동영상 전송 등 효율적인 데이터 전송이 필요한 어플리케이션에 사용하는 통신



## TCP

연결형 통신 프로토콜

- TCP 헤더를 붙여 세그먼트로 만든다.
- 연결을 확립하기 위해 TCP 헤더에 있는 코드 비트를 사용한다.



## 3-way Handshake

- 가상의 통신로인 Connection을 확보
- SYN 연결 요청
- ACK 연결 응답
- FIN 연결 종료



### SYN 연결 요청 -> SYN + ACK 연결 확립 응답 + 연결 확립 요청 => ACK 연결 확립 응답

- 1-> 2 연결해도 되나용
- 2 -> 1 네 됩니당~ 저도 연결해도 되나용
- 1 -> 2 네 됩니당~



### FIN 연결 종료 요청 -> ACK 연결 종료 응답 -> FIN 연결 종료 요청 -> ACK 연결 종료 응답

- 1->2 종료해도 되나용
- 2->1 네 됩니당, 저도 종료해도 되나용
- 1->2 네 됩니당



## TCP 헤더의 일련번호와 확인 응답 번호

3-way 핸드쉐이크가 끝나고 실제 데이터를 보내거나 상대방이 받을 때 사용

### sequence number, 일련번호

- 데이터를 분할해서 송신할 때, 수신측에게 몇 번째 데이터인지 알려준다.

### acknowledgement number, 확인 응답 번호

- 수신 측이 몇 번째 데이터를 수신했는지 송신 측에 알려준다.
- 다음 데이터를 요청하는데 사용한다.

### 재전송 제어

- 데이터가 손상되거나 유실된 경우 일정 시간 대기 후 재전송한다.



## 버퍼와 오버플로우

세그먼트(데이터)를 하나씩 보내고 한 번 씩 응답하는 것은 비효율적! 한 번에 여러 개를 보내자!

### 버퍼(buffer)

- 받은 세그먼트를 일시적으로 보관
- 3-way handshake때 서로의 버퍼 (window size) 윈도우 사이즈를 확인한다.

### 오버플로우(overflow)

- 데이터의 크기가 수신측 버퍼 크키(윈도우 크기)를 넘어서는 것





## TCP 와 포트번호

- 포트번호를 통해 어떤 어플리케이션인지 구분
- 0 ~ 65535번 사용
- 0 ~ 1023 : well-known ports



## UDP 와 포트번호

- UCP 헤더가 붙은 데이터 == UDP 데이터그램
- 랜에 있는 컴퓨터나 네트워크 장비에 데이터를 일괄로 보낸다 == **브로드캐스트(broadcast)**







# 5. 응용 계층(세션계층 + 표현계층)

## 역할

- 클라이언트 요청을 변환하고 전송 계층으로 전달



## 프로토콜

- 웹사이트를 볼 때 `HTTP`
- 파일 전송할 때 `FTP`
- 메일 보낼 때 `SMTP` 

- 메일 받을 때 `POP3` 
- 네트워크에서 컴퓨터나 네트워크 장비에 붙여진 이름을 기반으로 IP주소를 알아낼 때 `DNS` 



## 웹사이트 : HTTP

- 클라이언트는 서버의 80번 포트를 이용하여 HTTP 통신
- 클라이언트가 HTTP 요청을 보내고, 서버에서 HTTP 응답을 받는다.
- HTTP/1.1 버젼은 `keepalive` 기능이 있어서 데이터 교환하는 동안 연결을 유지하고 데이터 교환이 끝나면 연결을 끊는다.
- HTTP/2 버젼은 요청 보낸 순서대로 응답을 보내지 않아도 된다.



## DNS 서버

URL을 IP주소로 변환하는 서비스(시스템)

- 컴퓨터에서 DNS 서버로 `도메인 이름` 의 IP 주소를 요청
- DNS 서버가 해당 URL 의 IP 주소를 반환
- 컴퓨터는 IP 주소로 웹서버에 접속

DNS 서버는 전 세계에 흩어져 있고, 서로 연계하여 동작한다.



## 메일 서버 SMTP, POP3

- 메일을 보내는 SMTP : 25번
- 메일을 받는 POP : 110번
- 컴퓨터 1 -> 메일서버 1 -> 메일서버 2 -> 컴퓨터 2



# 총정리

- 참고자료 : 모두의 네트워크

![network](network0.jpg)

![network](network1.jpg)
